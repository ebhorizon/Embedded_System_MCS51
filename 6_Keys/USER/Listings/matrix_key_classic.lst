C51 COMPILER V9.57.0.0   MATRIX_KEY_CLASSIC                                                06/04/2020 23:18:55 PAGE 1   


C51 COMPILER V9.57.0.0, COMPILATION OF MODULE MATRIX_KEY_CLASSIC
OBJECT MODULE PLACED IN ..\OBJ\matrix_key_classic.obj
COMPILER INVOKED BY: e:\Keil_v5\C51\BIN\C51.EXE ..\HARDWARE\matrix_key_classic.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\HARD
                    -WARE) DEBUG OBJECTEXTEND PRINT(.\Listings\matrix_key_classic.lst) OBJECT(..\OBJ\matrix_key_classic.obj)

line level    source

   1          #include "matrix_key_classic.h"
   2          
   3          void MatrixKeyDelay(uint t)
   4          {
   5   1              while(t--);
   6   1      }
   7          
   8          // 扫描哪个按键按下了
   9          uchar MatrixKeyScan()
  10          {
  11   1              uchar k = 0, keyVal = 0;
  12   1              
  13   1              // 置0000 1111
  14   1              MATRIXKEYS = 0x0F;
  15   1              // 判断如果按下了
  16   1              if(MATRIXKEYS != 0x0F)
  17   1              {
  18   2                      MatrixKeyDelay(1000);                                   // 消抖
  19   2                      switch(MATRIXKEYS)
  20   2                      {
  21   3                              case 0x07: keyVal = 1; break;           // 0000 0111
  22   3                              case 0x0B: keyVal = 2; break;           // 0000 1011
  23   3                              case 0x0D: keyVal = 3; break;           // 0000 1101
  24   3                              case 0x0E: keyVal = 4; break;           // 0000 1110
  25   3                      }
  26   2                      
  27   2                      // 立马置1111 0000
  28   2                      MATRIXKEYS = 0xF0;
  29   2                      switch(MATRIXKEYS)
  30   2                      {
  31   3                              case 0x70:                               break;         // 0111 0000
  32   3                              case 0xB0: keyVal += 4;  break;         // 1011 0000
  33   3                              case 0xD0: keyVal += 8;  break;         // 1101 0000
  34   3                              case 0xE0: keyVal += 12; break;         // 1110 0000
  35   3                      }
  36   2                      
  37   2                      // 等待释放的过程延迟500ms强制释放
  38   2                      while((k++ < 50) && (MATRIXKEYS != 0xF0))       MatrixKeyDelay(1000);
  39   2              }
  40   1              
  41   1              return keyVal;
  42   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    128    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
